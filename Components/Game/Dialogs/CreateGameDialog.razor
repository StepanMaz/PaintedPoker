@using PaintedPoker.Game
@using PaintedPoker.Game.Services;

<MudDialog>
    <DialogContent>
        <MudTextField Label="Game Name" DebounceInterval="300" OnDebounceIntervalElapsed="(v) => GameName = v"
            @bind-Value="GameName" style="margin-bottom: 10px;" MaxLength="MAX_GAME_NAME_LENGTH" />
        <MudNumericField Label="Player Count" @bind-Value="PlayerCount" Min="MIN_PLAYER_COUNT" Max="MAX_PLAYER_COUNT"
            style="margin-bottom: 10px;" />
        <MudRadioGroup T="DeckSize">
            <MudRadio T="DeckSize" Option="DeckSize.Large">Big Card Deck</MudRadio>
            <MudRadio T="DeckSize" Option="DeckSize.Small">Small Card Deck</MudRadio>
        </MudRadioGroup>
    </DialogContent>
    <DialogActions>
        <MudButton Disabled="Disabled" OnClick="Submit" Color="Color.Success" Variant="Variant.Filled">Create
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    private const int MAX_PLAYER_COUNT = 52;
    private const int MIN_PLAYER_COUNT = 2;
    private const int MAX_GAME_NAME_LENGTH = 40;

    private bool Disabled => GameName.Length <= 4;

    [CascadingParameter]
    private MudDialogInstance MudDialog { get; set; } = null!;

    private DeckSize DeckSize { get; set; } = DeckSize.Large;
    private string GameName { get; set; } = "";
    private int _player_count = MIN_PLAYER_COUNT;
    private int PlayerCount
    {
        get => Math.Max(Math.Min(_player_count, MAX_PLAYER_COUNT), MIN_PLAYER_COUNT);
        set => _player_count = value;
    }

    private void Submit()
    {
        MudDialog.Close(DialogResult.Ok(
            new GameInfo(
            new GameName(GameName),
            new GameOptions()
                {
                    DeckSize = DeckSize,
                    PlayerCount = PlayerCount
                })
            )
        );
    }
}
