@attribute [Route(Nav.CreateGame), Route("")]
@using PaintedPoker.Components.Game.Dialogs
@using PaintedPoker.Game
@using System.Text.Json
@using PaintedPoker.Game.Builder
@using PaintedPoker.Game.Rules
@using PaintedPoker.Game.Services
@using PaintedPoker.Game.Table

@rendermode InteractiveServer

@inject IDialogService DialogService
@inject ISnackbar Snackbar
@inject GameService Tables
@inject NavigationManager NavigationManager

<MudPaper Class="my-3 p-2">
    <MudText>Press button to create new game.</MudText>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="HandleCreate">Create</MudButton>
</MudPaper>

@code {
    public async void HandleCreate()
    {
        var dialog = await DialogService.ShowAsync<CreateGameDialog>("Create New Game");

        var res = await dialog.Result;

        if (res is null || res.Canceled || res.Data is null) return;

        var data = (ValueTuple<string, GameBuilder>)res.Data;

        var gameName = new GameName(data.Item1);

        Tables.Add(gameName, data.Item2.Build());

        NavigationManager.NavigateTo(Nav.Game(gameName));
    }
}